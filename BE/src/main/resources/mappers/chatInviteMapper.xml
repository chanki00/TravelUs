<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.DB_PASSWORD_REDACTED.trip.chat.ChatInviteRepository">

  <!-- 초대 삽입 -->
<insert id="insertInvite" parameterType="com.DB_PASSWORD_REDACTED.trip.chat.ChatInvite">
  INSERT INTO chat_invite
    (chatroom_id, inviter_id, invitee_id, status, type, created_at)
  VALUES
    (#{chatroomId}, #{inviterId}, #{inviteeId}, #{status}, #{type}, #{createdAt})
</insert>



<!--   특정 유저의 대기중 초대 목록 -->
<!--  <select id="getInvitesByUserId" resultType="com.DB_PASSWORD_REDACTED.trip.chat.ChatInvite">-->
<!--    SELECT *-->
<!--    FROM chat_invite-->
<!--    WHERE invitee_id = #{userId}-->
<!--      AND status = 'PENDING'-->
<!--    ORDER BY created_at DESC-->
<!--  </select>-->

  <!-- 초대 응답 상태 변경 -->
  <update id="updateInviteStatus">
    UPDATE chat_invite
    SET status = #{status}
    WHERE id = #{id}
  </update>

  <!-- 초대 ID로 조회 -->
<select id="findById" resultMap="ChatInviteMap">
  SELECT * FROM chat_invite WHERE id = #{id}
</select>

<resultMap id="ChatInviteMap" type="com.DB_PASSWORD_REDACTED.trip.chat.ChatInvite">
  <id property="id" column="id"/>
  <result property="chatroomId" column="chatroom_id"/>
  <result property="inviterId" column="inviter_id"/>
  <result property="inviteeId" column="invitee_id"/>
  <result property="status" column="status"/>
  <result property="createdAt" column="created_at"/>
</resultMap>
  
<!-- resources/mappers/chatInviteMapper.xml -->
<resultMap id="ChatInviteResponseMap" type="com.DB_PASSWORD_REDACTED.trip.chat.ChatInviteResponse">
  <id property="id" column="id"/>
  <result property="chatroomId" column="chatroom_id"/>
  <result property="inviterId" column="inviter_id"/>
  <result property="inviteeId" column="invitee_id"/>
  <result property="name" column="name"/>
  <result property="status" column="status"/>
  <result property="type" column="type"/>         <!-- ✅ 추가된 라인 -->
  <result property="createdAt" column="created_at"/>
</resultMap>

<select id="getInvitesByUserId" resultMap="ChatInviteResponseMap">
  SELECT
    ci.id,
    ci.chatroom_id,
    ci.inviter_id,
    u.name,
    ci.invitee_id,
    ci.status,
    ci.type,               <!-- ✅ 추가된 라인 -->
    ci.created_at
  FROM chat_invite ci
  JOIN users u ON ci.inviter_id = u.id
  WHERE ci.invitee_id = #{userId}
</select>

<select id="getRequestsByUserId" resultMap="ChatInviteResponseMap">
  SELECT
    ci.id,
    ci.chatroom_id,
    ci.inviter_id,
    ci.invitee_id,
    ci.status,
    ci.created_at,
    ci.type,
    u.name
  FROM chat_invite ci
  JOIN users u ON ci.inviter_id = u.id
  WHERE ci.invitee_id = #{userId}
    AND ci.type = 'REQUEST'
</select>



</mapper>